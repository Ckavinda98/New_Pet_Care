<?php
session_start();
include 'connect.php';

class Login {
  // ...

  public function SessionCheck() {
    global $conn;

    // Storing Session
    $user_check = $_SESSION['login'];

    // SQL Query To Fetch Complete Information Of User
    $query = "SELECT * FROM user WHERE username = '$user_check'";
    $ses_sql = mysqli_query($conn, $query);
    $row = mysqli_fetch_assoc($ses_sql);
    $_SESSION["user_id"] = $row["user_id"];
    $_SESSION["username"] = $row["username"];
    $_SESSION["user_type"] = $row["user_type"];
    $_SESSION["password"] = $row["password"];
  }
}

// Create an instance of the Login class
$login = new Login();

// Call the SessionCheck method to retrieve and store user_id and business_id
$login->SessionCheck();

// Get the user_id from the session
$user_id = $_SESSION["user_id"];



// Fetch user data for the logged user
$query = "SELECT * FROM user";
$result = mysqli_query($conn, $query);

// Function to display user data in a table
function displayUser($result) {
  if (mysqli_num_rows($result) > 0) {
    echo '<table>
    <tr>
      <th>User ID</th>
      <th>User Name</th>
      <th>Email</th>
      <th>User Type</th>
      <th>Edit</th>
      <th>Delete</th>
    </tr>';

    while ($user = mysqli_fetch_assoc($result)) {
      echo '<tr>';
      echo '<td>' . $user["user_id"] . '</td>';
      echo '<td><input type="text" name="username[' . $user["user_id"] . ']" value="' . $user["username"] . '"></td>';
      echo '<td><input type="email" name="email[' . $user["user_id"] . ']" value="' . $user["email"] . '"></td>';
      echo '<td>
              <select name="user_type[' . $user["user_id"] . ']">
                <option value="admin" ' . ($user["user_type"] === "admin" ? "selected" : "") . '>Admin</option>
                <option value="Pet Owner" ' . ($user["user_type"] === "Pet Owner" ? "selected" : "") . '>Pet Owner</option>
                <option value="Pet Shop" ' . ($user["user_type"] === "Pet Shop" ? "selected" : "") . '>Pet Shop</option>
                <option value="Veterinarian" ' . ($user["user_type"] === "Veterinarian" ? "selected" : "") . '>Veterinarian</option>
                <option value="Pharmacist" ' . ($user["user_type"] === "Pharmacist" ? "selected" : "") . '>Pharmacist</option>
                <option value="Pet Grooming" ' . ($user["user_type"] === "Pet Grooming" ? "selected" : "") . '>Pet Grooming</option>
                <option value="Pet DayCare" ' . ($user["user_type"] === "Pet DayCare" ? "selected" : "") . '>Pet Day Care</option>
                <option value="Service Provider" ' . ($user["user_type"] === "Service Provider" ? "selected" : "") . '>Service Provider</option>
              </select>
            </td>';
    
      echo '<td>';
      echo '<button class="edit-button" onclick="updateUser(' . $user["user_id"] . ')">Edit</button>';
      echo '</td>';
    
      echo '<td>';
      echo '<form action="function.php" method="post">';
      echo '<input type="hidden" name="user_id" value="' . $user["user_id"] . '">';
      echo '<button class="delete-button" type="submit">Delete</button>';
      echo '</form>';
      echo '</td>';
    
      echo '</tr>';
    }
    

echo '</table>';



  } else {
    echo 'No users found.';
  }
}

// Display the appointment data
// displayAppointments($result);

// Close the database connection
mysqli_close($conn);
?>


script file 

<script>
 

 function updateUser(userId) {
  console.log('updateUser function called with userId:', userId);
  var username = document.getElementsByName('username[' + userId + ']')[0].value;
  var email = document.getElementsByName('email[' + userId + ']')[0].value;
  var userType = document.getElementsByName('user_type[' + userId + ']')[0].value;

  // Perform the update using AJAX
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'function.php', true);
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.onreadystatechange = function() {
    if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
      // Handle the response from the server
      alert(xhr.responseText); // Display a success message or handle any errors
    }
  };
  xhr.send('user_id=' + userId + '&username=' + encodeURIComponent(username) + '&email=' + encodeURIComponent(email) + '&user_type=' + encodeURIComponent(userType));
}


</script>

function.php file 


<?php
session_start();
var_dump($_POST);

// Connect to the database
$db = mysqli_connect('localhost', 'root', '', 'pet_care_db');
if (!$db) {
    die('Connect Error: ' . mysqli_connect_error());
}

// Check if the form is submitted
if ($_SERVER["REQUEST_METHOD"] === "POST") {
    // Retrieve the user ID from the form
    $userId = (int)$_POST["user_id"];
  
    // Retrieve the updated username, email, and user type from the form
    $username = $_POST["username"];
    $email = $_POST["email"];
    $userType = $_POST["user_type"];
  
    // Perform the update query
    $query = "UPDATE user SET username='$username', email='$email', user_type='$userType' WHERE user_id='$userId'";
  
    // Execute the query
    if (mysqli_query($db, $query)) {
        echo '<script>alert("User updated successfully.");</script>';
        // echo '<script>window.location.href = "usertable.php";</script>';
    } else {
        echo '<script>alert("Error updating user: ' . mysqli_error($db) . '");</script>';
        echo '<script>window.location.href = "usertable.php";</script>';
    }
}
  
// user delete 
// Check if form is submitted
// if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Retrieve user ID from form submission
    // $userId = $_POST["user_id"];
  
    // Perform the delete query using the retrieved user ID
    // $sql = "DELETE FROM user WHERE user_id='$userId'";
  
    // Execute the query
//     if (mysqli_query($db, $sql)) {
//         echo '<script>alert("User deleted successfully.");</script>';
//         echo '<script>window.location.href = "usertable.php";</script>';
//     } else {
//         echo '<script>alert("Error deleting user: ' . mysqli_error($db) . '");</script>';
//         echo '<script>window.location.href = "usertable.php";</script>';
//     }
// }
?>

